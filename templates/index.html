<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>родрооро┐ро┤рпН ро╡рпЗрод роЬрпЛродро┐роЯроорпН - Tamil Vedic Astrology</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Tamil:wght@400;600;700&display=swap');
        body { font-family: 'Noto Sans Tamil', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-shadow { box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2">ЁЯФо родрооро┐ро┤рпН ро╡рпЗрод роЬрпЛродро┐роЯроорпН</h1>
            <p class="text-white/80">AI-Powered Tamil Vedic Astrology Predictions</p>
        </div>

        <!-- Main Card -->
        <div class="max-w-2xl mx-auto bg-white rounded-2xl card-shadow p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">ЁЯУЕ рокро┐ро▒роирпНрод ро╡ро┐ро╡ро░роЩрпНроХро│рпН</h2>
            
            <form id="astroForm" class="space-y-6">
                <!-- Name -->
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">
                        ЁЯСд рокрпЖропро░рпН (Name)
                    </label>
                    <input type="text" id="name" name="name" required
                        placeholder="роЙроЩрпНроХро│рпН рокрпЖропро░рпН"
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none transition">
                </div>

                <!-- Gender -->
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">
                        ЁЯЪ╗ рокро╛ро▓ро┐ройроорпН (Gender)
                    </label>
                    <select id="gender" name="gender" required
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none transition">
                        <option value="роЖрогрпН">ЁЯСи роЖрогрпН (Male)</option>
                        <option value="рокрпЖрогрпН">ЁЯСй рокрпЖрогрпН (Female)</option>
                    </select>
                </div>

                <!-- Birth Date -->
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">
                        ЁЯЧУя╕П рокро┐ро▒роирпНрод родрпЗродро┐ (Birth Date)
                    </label>
                    <input type="date" id="birth_date" name="birth_date" required
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none transition">
                </div>

                <!-- Birth Time with AM/PM -->
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">
                        тП░ рокро┐ро▒роирпНрод роирпЗро░роорпН (Birth Time)
                    </label>
                    <div class="flex gap-2">
                        <input type="number" id="birth_hour" name="birth_hour" min="1" max="12" required
                            placeholder="роорогро┐ (1-12)"
                            class="w-1/3 px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none transition">
                        <input type="number" id="birth_minute" name="birth_minute" min="0" max="59" required
                            placeholder="роиро┐рооро┐роЯроорпН (0-59)"
                            class="w-1/3 px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none transition">
                        <select id="birth_ampm" name="birth_ampm" required
                            class="w-1/3 px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none transition">
                            <option value="AM">ЁЯМЕ роХро╛ро▓рпИ (AM)</option>
                            <option value="PM">ЁЯМЩ рооро╛ро▓рпИ/роЗро░ро╡рпБ (PM)</option>
                        </select>
                    </div>
                    <p class="text-sm text-gray-500 mt-1">
                        ЁЯТб роЙродро╛ро░рогроорпН: роХро╛ро▓рпИ 9:26 = 9, 26, AM | роЗро░ро╡рпБ 9:26 = 9, 26, PM
                    </p>
                </div>

                <!-- Birth Place -->
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">
                        ЁЯУН рокро┐ро▒роирпНрод роЗроЯроорпН (Birth Place)
                    </label>
                    <input type="text" id="birth_place" name="birth_place" required
                        placeholder="роЙродро╛: Chennai, Madurai, Coimbatore"
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none transition">
                </div>

                <!-- Question Type -->
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">
                        тЭУ рокро▓ройрпН ро╡роХрпИ (Prediction Type)
                    </label>
                    <select id="question_type" name="question_type"
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none transition">
                        <option value="рокрпКродрпБ">ЁЯМЯ рокрпКродрпБ рокро▓ройрпН (General)</option>
                        <option value="родрпКро┤ро┐ро▓рпН">ЁЯТ╝ родрпКро┤ро┐ро▓рпН (Career)</option>
                        <option value="родро┐ро░рпБроорогроорпН">ЁЯТС родро┐ро░рпБроорогроорпН (Marriage)</option>
                        <option value="роЖро░рпЛроХрпНроХро┐ропроорпН">ЁЯПе роЖро░рпЛроХрпНроХро┐ропроорпН (Health)</option>
                        <option value="рокрогроорпН">ЁЯТ░ рокрогроорпН (Finance)</option>
                        <option value="роХро▓рпНро╡ро┐">ЁЯУЪ роХро▓рпНро╡ро┐ (Education)</option>
                    </select>
                </div>

                <!-- Submit Button -->
                <button type="submit" id="submitBtn"
                    class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-bold py-4 rounded-lg hover:from-purple-700 hover:to-indigo-700 transition transform hover:scale-105">
                    ЁЯФо рокро▓ройрпН рокро╛ро░рпНроХрпНроХ (Get Prediction)
                </button>
            </form>

            <!-- Loading -->
            <div id="loading" class="hidden text-center py-8">
                <div class="animate-spin rounded-full h-16 w-16 border-4 border-purple-500 border-t-transparent mx-auto mb-4"></div>
                <p class="text-gray-600">AI рокро▓ройрпН роХрогро┐роХрпНроХро┐ро▒родрпБ... роЪро┐ро▒ро┐родрпБ роирпЗро░роорпН роХро╛родрпНродро┐ро░рпБроЩрпНроХро│рпН...</p>
            </div>

            <!-- Result -->
            <div id="result" class="hidden mt-8 space-y-6">
                <!-- Jathaga Kattam -->
                <div id="kattamSection" class="bg-gradient-to-r from-orange-50 to-yellow-50 p-6 rounded-xl border border-orange-200">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">ЁЯФо роЬро╛родроХ роХроЯрпНроЯроорпН (Birth Chart)</h3>
                    <div id="jathagaKattam" class="grid grid-cols-4 gap-1 max-w-md mx-auto"></div>
                </div>

                <!-- Basic Info -->
                <div id="basicInfo" class="bg-gradient-to-r from-blue-50 to-cyan-50 p-6 rounded-xl border border-blue-200">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">ЁЯУЛ роЕроЯро┐рокрпНрокроЯрпИ ро╡ро┐ро╡ро░роЩрпНроХро│рпН</h3>
                    <div id="basicDetails" class="grid grid-cols-2 gap-4"></div>
                </div>

                <!-- Planetary Positions -->
                <div id="planetSection" class="bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-xl border border-green-200">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">ЁЯкР роХро┐ро░роХ роиро┐ро▓рпИроХро│рпН (Planetary Positions)</h3>
                    <div id="planetTable" class="overflow-x-auto"></div>
                </div>

                <!-- Dasha Bhukti -->
                <div id="dashaSection" class="bg-gradient-to-r from-pink-50 to-rose-50 p-6 rounded-xl border border-pink-200">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">ЁЯУЕ родроЪро╛-рокрпБроХрпНродро┐ ро╡ро┐ро╡ро░роЩрпНроХро│рпН</h3>
                    <div id="currentDasha" class="mb-4 p-4 bg-white rounded-lg shadow"></div>
                    <div id="allDasha" class="space-y-2"></div>
                </div>

                <!-- AI Prediction -->
                <div id="predictionSection" class="bg-gradient-to-r from-purple-50 to-indigo-50 p-6 rounded-xl border border-purple-200">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">ЁЯУЬ AI роЬрпЛродро┐роЯ рокро▓ройрпН</h3>
                    <div id="prediction" class="whitespace-pre-wrap text-gray-700"></div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center mt-8 text-white/60 text-sm">
            <p>Powered by ChatGPT AI тАв Built with тЭдя╕П for Tamil Astrology</p>
        </div>
    </div>

    <script>
        document.getElementById('astroForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const loading = document.getElementById('loading');
            const result = document.getElementById('result');
            
            // Show loading
            submitBtn.classList.add('hidden');
            loading.classList.remove('hidden');
            result.classList.add('hidden');
            
            // Convert 12-hour to 24-hour format
            let hour = parseInt(document.getElementById('birth_hour').value);
            const minute = String(document.getElementById('birth_minute').value).padStart(2, '0');
            const ampm = document.getElementById('birth_ampm').value;
            
            console.log('Hour:', hour, 'Minute:', minute, 'AMPM:', ampm);
            
            // Convert to 24-hour format
            if (ampm === 'PM' && hour !== 12) {
                hour += 12;
            } else if (ampm === 'AM' && hour === 12) {
                hour = 0;
            }
            const birth_time_24 = hour.toString().padStart(2, '0') + ':' + minute;
            
            const data = {
                name: document.getElementById('name').value,
                gender: document.getElementById('gender').value,
                birth_date: document.getElementById('birth_date').value,
                birth_time: birth_time_24,
                birth_place: document.getElementById('birth_place').value,
                question_type: document.getElementById('question_type').value
            };
            
            try {
                console.log('Sending data:', data);
                
                const response = await fetch('/api/prediction', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                console.log('Response status:', response.status);
                const json = await response.json();
                console.log('Response JSON:', json);
                
                // Display Jathaga Kattam
                if (json.роЬро╛родроХ_роХроЯрпНроЯроорпН) {
                    displayKattam(json.роЬро╛родроХ_роХроЯрпНроЯроорпН);
                }
                
                // Display Basic Info
                if (json.роЬро╛родроХроорпН) {
                    displayBasicInfo(json.роЬро╛родроХроорпН, data.name, data.gender);
                    displayPlanets(json.роЬро╛родроХроорпН.роХро┐ро░роХроЩрпНроХро│рпН);
                    displayDasha(json.роЬро╛родроХроорпН.родроЪро╛);
                }
                
                // Display AI Prediction
                if (json.рокро▓ройрпН) {
                    document.getElementById('prediction').innerHTML = json.рокро▓ройрпН.replace(/\n/g, '<br>');
                }
                
                result.classList.remove('hidden');
                
            } catch (error) {
                document.getElementById('prediction').innerHTML = `<p class="text-red-500">Error: ${error.message}</p>`;
                result.classList.remove('hidden');
            }
            
            loading.classList.add('hidden');
            submitBtn.classList.remove('hidden');
        });

        function displayKattam(kattam) {
            const container = document.getElementById('jathagaKattam');
            container.innerHTML = '';
            
            const rasiColors = {
                'роорпЗро╖роорпН': 'bg-red-100', 'ро░ро┐ро╖рокроорпН': 'bg-green-100', 'рооро┐родрпБройроорпН': 'bg-yellow-100',
                'роХроЯроХроорпН': 'bg-blue-100', 'роЪро┐роорпНроороорпН': 'bg-orange-100', 'роХройрпНройро┐': 'bg-emerald-100',
                'родрпБро▓ро╛роорпН': 'bg-pink-100', 'ро╡ро┐ро░рпБроЪрпНроЪро┐роХроорпН': 'bg-purple-100', 'родройрпБроЪрпБ': 'bg-indigo-100',
                'роороХро░роорпН': 'bg-gray-100', 'роХрпБроорпНрокроорпН': 'bg-cyan-100', 'роорпАройроорпН': 'bg-teal-100'
            };
            
            kattam.роХроЯрпНроЯроорпН.forEach(row => {
                row.forEach(cell => {
                    const div = document.createElement('div');
                    const bgColor = rasiColors[cell.ро░ро╛роЪро┐] || 'bg-gray-50';
                    div.className = `${bgColor} border border-gray-300 p-2 text-center min-h-[70px] text-xs`;
                    
                    if (cell.ро░ро╛роЪро┐) {
                        div.innerHTML = `
                            <div class="font-bold text-gray-700">${cell.ро░ро╛роЪро┐}</div>
                            <div class="text-purple-600 font-semibold">${cell.роХро┐ро░роХроЩрпНроХро│рпН.join(' ')}</div>
                        `;
                    }
                    container.appendChild(div);
                });
            });
        }

        function displayBasicInfo(chart, name, gender) {
            const container = document.getElementById('basicDetails');
            const genderIcon = gender === 'роЖрогрпН' ? 'ЁЯСи' : 'ЁЯСй';
            container.innerHTML = `
                <div class="p-3 bg-white rounded-lg shadow">
                    <span class="text-gray-500">ЁЯСд рокрпЖропро░рпН:</span>
                    <span class="font-bold">${name || '-'}</span>
                </div>
                <div class="p-3 bg-white rounded-lg shadow">
                    <span class="text-gray-500">ЁЯЪ╗ рокро╛ро▓ро┐ройроорпН:</span>
                    <span class="font-bold text-blue-600">${genderIcon} ${gender || '-'}</span>
                </div>
                <div class="p-3 bg-white rounded-lg shadow">
                    <span class="text-gray-500">ЁЯУЕ рокро┐ро▒роирпНрод роХро┐ро┤роорпИ:</span>
                    <span class="font-bold text-orange-600">${chart['рокро┐ро▒роирпНрод роХро┐ро┤роорпИ'] || '-'}</span>
                </div>
                <div class="p-3 bg-white rounded-lg shadow">
                    <span class="text-gray-500">ЁЯМЩ ро░ро╛роЪро┐:</span>
                    <span class="font-bold text-purple-600">${chart.ро░ро╛роЪро┐}</span>
                </div>
                <div class="p-3 bg-white rounded-lg shadow">
                    <span class="text-gray-500">тнР роироЯрпНроЪродрпНродро┐ро░роорпН:</span>
                    <span class="font-bold text-indigo-600">${chart['роЬрпЖройрпНроо роироЯрпНроЪродрпНродро┐ро░роорпН']}</span>
                </div>
                <div class="p-3 bg-white rounded-lg shadow">
                    <span class="text-gray-500">ЁЯПа ро▓роХрпНройроорпН:</span>
                    <span class="font-bold text-green-600">${chart.ро▓роХрпНройроорпН?.ро░ро╛роЪро┐ || '-'}</span>
                </div>
            `;
        }

        function displayPlanets(planets) {
            const container = document.getElementById('planetTable');
            let html = `<table class="w-full text-sm">
                <thead class="bg-green-200">
                    <tr>
                        <th class="p-2 text-left">роХро┐ро░роХроорпН</th>
                        <th class="p-2 text-left">ро░ро╛роЪро┐</th>
                        <th class="p-2 text-left">роироЯрпНроЪродрпНродро┐ро░роорпН</th>
                        <th class="p-2 text-left">рокро╛родроорпН</th>
                        <th class="p-2 text-left">рокро╛роХрпИ</th>
                    </tr>
                </thead>
                <tbody>`;
            
            for (const [planet, data] of Object.entries(planets)) {
                html += `<tr class="border-b hover:bg-green-50">
                    <td class="p-2 font-semibold">${planet}</td>
                    <td class="p-2">${data.ро░ро╛роЪро┐}</td>
                    <td class="p-2">${data.роироЯрпНроЪродрпНродро┐ро░роорпН}</td>
                    <td class="p-2">${data.рокро╛родроорпН}</td>
                    <td class="p-2">${data.рокро╛роХрпИ}┬░</td>
                </tr>`;
            }
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function displayDasha(dasha) {
            // Current Dasha & Bhukti
            const currentDiv = document.getElementById('currentDasha');
            if (dasha.родро▒рпНрокрпЛродрпИроп_родроЪро╛) {
                let currentHtml = `
                    <h4 class="font-bold text-pink-700 mb-2">ЁЯФ┤ родро▒рпНрокрпЛродрпИроп родроЪро╛-рокрпБроХрпНродро┐</h4>
                    <p><strong>родроЪро╛:</strong> <span class="text-lg font-bold text-purple-600">${dasha.родро▒рпНрокрпЛродрпИроп_родроЪро╛.родроЪро╛}</span></p>
                    <p><strong>роХро╛ро▓роорпН:</strong> ${dasha.родро▒рпНрокрпЛродрпИроп_родроЪро╛.родрпКроЯроХрпНроХроорпН} роорпБродро▓рпН ${dasha.родро▒рпНрокрпЛродрпИроп_родроЪро╛.роорпБроЯро┐ро╡рпБ} ро╡ро░рпИ</p>
                `;
                if (dasha.родро▒рпНрокрпЛродрпИроп_рокрпБроХрпНродро┐) {
                    currentHtml += `
                        <p class="mt-2"><strong>рокрпБроХрпНродро┐:</strong> <span class="text-lg font-bold text-indigo-600">${dasha.родро▒рпНрокрпЛродрпИроп_рокрпБроХрпНродро┐.рокрпБроХрпНродро┐}</span></p>
                        <p><strong>рокрпБроХрпНродро┐ роХро╛ро▓роорпН:</strong> ${dasha.родро▒рпНрокрпЛродрпИроп_рокрпБроХрпНродро┐.родрпКроЯроХрпНроХроорпН} роорпБродро▓рпН ${dasha.родро▒рпНрокрпЛродрпИроп_рокрпБроХрпНродро┐.роорпБроЯро┐ро╡рпБ} ро╡ро░рпИ</p>
                    `;
                }
                currentDiv.innerHTML = currentHtml;
            }
            
            // All Dashas with Bhukti
            const allDiv = document.getElementById('allDasha');
            let allHtml = '<h4 class="font-bold text-pink-700 mb-3">ЁЯУЛ роЕройрпИродрпНродрпБ родроЪро╛-рокрпБроХрпНродро┐ ро╡ро┐ро╡ро░роЩрпНроХро│рпН</h4>';
            
            dasha.роЕройрпИродрпНродрпБ_родроЪро╛роХрпНроХро│рпН?.forEach((d, idx) => {
                const isExpanded = idx === 0 ? 'block' : 'hidden';
                allHtml += `
                    <div class="border rounded-lg overflow-hidden mb-2">
                        <button onclick="toggleDasha(${idx})" class="w-full p-3 bg-gradient-to-r from-pink-100 to-rose-100 text-left font-semibold flex justify-between items-center">
                            <span>ЁЯМЯ ${d.родроЪро╛} родроЪро╛ (${d.роЖрогрпНроЯрпБроХро│рпН} роЖрогрпНроЯрпБроХро│рпН)</span>
                            <span class="text-sm text-gray-600">${d.родрпКроЯроХрпНроХроорпН} - ${d.роорпБроЯро┐ро╡рпБ}</span>
                        </button>
                        <div id="dasha-${idx}" class="${isExpanded} p-3 bg-white">
                            <table class="w-full text-sm">
                                <thead class="bg-pink-50">
                                    <tr>
                                        <th class="p-2 text-left">рокрпБроХрпНродро┐</th>
                                        <th class="p-2 text-left">родрпКроЯроХрпНроХроорпН</th>
                                        <th class="p-2 text-left">роорпБроЯро┐ро╡рпБ</th>
                                        <th class="p-2 text-left">рооро╛родроЩрпНроХро│рпН</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${d.рокрпБроХрпНродро┐?.map(b => `
                                        <tr class="border-b hover:bg-pink-50">
                                            <td class="p-2 font-semibold">${b.рокрпБроХрпНродро┐}</td>
                                            <td class="p-2">${b.родрпКроЯроХрпНроХроорпН}</td>
                                            <td class="p-2">${b.роорпБроЯро┐ро╡рпБ}</td>
                                            <td class="p-2">${b.рооро╛родроЩрпНроХро│рпН}</td>
                                        </tr>
                                    `).join('') || ''}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            });
            
            allDiv.innerHTML = allHtml;
        }

        function toggleDasha(idx) {
            const el = document.getElementById(`dasha-${idx}`);
            el.classList.toggle('hidden');
        }
    </script>
</body>
</html>
